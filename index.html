<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foresight Creator</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        header {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f8f8f8;
            padding: 10px 20px;
            border-bottom: 2px solid #e0e0e0;
            position: relative;
            z-index: 2;
        }

        .logo {
            display: flex;
            align-items: center;
            position: absolute;
            left: 20px;
        }

        .logo img {
            height: 30px;
            margin-right: 10px;
        }

        h1 {
            margin: 0;
            font-size: 24px;
            color: #333;
        }

        main {
            position: relative;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            min-height: calc(100vh - 60px);
        }

        .circle {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: #d3d3d3;
            width: 800px;
            height: 800px;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 2;
            overflow: hidden; /* Prevent video overflow */
        }

        /* Style for the video background */
        #backgroundVideo {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%; /* Adjust to cover the circle */
            height: auto; /* Maintain aspect ratio */
            min-height: 100%; /* Ensure it covers the circle */
            object-fit: cover; /* Ensures video fills the area */
            transform: translate(-50%, -50%);
            z-index: 1; /* Position behind other content */
        }

        .circle img, .circle div, .circle button, .circle p {
            z-index: 2; /* Ensure all child elements are on top */
            position: relative; /* Relative positioning for proper stacking */
        }

        .quadrant-circle {
            width: 500px;
            height: 500px;
            background-color: #f5f5f5;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            /* box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); */
            position: absolute;
            z-index: 2;
            font-size: 30px; /* Font size for the title */
            font-weight: bold; /* Bold title */
            position:releative;
        }

        .quadrant-circle span {
            font-size: 20px; /* Smaller subtitle */
            font-weight: normal; /* Subtitle not bold */
        }

        .quadrant-circle {
            display: none; /* Hidden by default */
        }

        .circle p {
            font-size: 18px;
            margin-bottom: 20px;
            color: #333;
        }

        .circle button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #fff;
            border: 1px solid #333;
            cursor: pointer;
        }
        
        .percentage-circle {
            position: absolute;
            width: 0;
            height: 0;
            background-color: rgba(255, 0, 0, 0.5); /* Example color with transparency */
            border-radius: 50%;
            transition: width 1s ease-out, height 1s ease-out, top 1s ease-out, left 1s ease-out; /* Smooth transition */
            z-index: 1;
            display: none; /* Hidden by default */
            display: flex; /* To center the text inside */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            color: white; /* Text color */
            font-weight: bold; /* Bold text */
            font-size: 16px; /* Font size for percentage */
        }

        .percentage-circle.red-circle {
            background-color: rgba(31, 197, 250, 0.5); /* New blue color with transparency */
        }

        .percentage-circle.green-circle {
            background-color: rgba(64, 203, 70, 0.5); /* New green color with transparency */
        }

        .percentage-text {
            display: block; /* Ensures the text behaves as block element */
            text-align: center; /* Center the text */
        }

        .text-container {
            position: relative; /* Position relative to the quadrant-circle */
            z-index: 3; /* Higher z-index to place the text on top of the percentage circles */
            text-align: center; /* Center align the text */
        }

        .lines {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 90%;
            height: 90%;
            transform: translate(-50%, -50%);
            display: none;
            z-index: 1;
        }

        .vertical-line, .horizontal-line {
            position: absolute;
            background-color: black;
        }

        .vertical-line {
            width: 4px;
            height: 90%;
            left: 50%;
            top: 5%;
            transform: translateX(-50%);
        }

        .horizontal-line {
            height: 4px;
            width: 80%;
            top: 50%;
            left: 10%;
            transform: translateY(-50%);
        }

        .label {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            color: rgb(60, 60, 60);
        }

        .label.energy-efficient { top: 0; left: 50%; transform: translateX(-50%); }
        .label.energy-inefficient { bottom: 0; left: 50%; transform: translateX(-50%); }
        .label.individual { left: 0; top: 50%; transform: translateY(-50%); }
        .label.collective { right: 0; top: 50%; transform: translateY(-50%); }

        /* Categories Circle Style */
        .categories-circle {
            position: absolute;
            width: 500px;
            height: 500px;
            background-color: #e0e0e0;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 2;
        }

        .category {
            position: absolute;
            width: 180px; /* Adjust width as needed */
            height: 180px;
            padding: 10px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: white; /* Changed from #333 to white for better contrast */            
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* Add shadow to the text */
            background-color: rgb(195, 195, 195);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 50%; /* Ensures the circle remains circular */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);            
            transform: translate(-50%, -50%); /* Center the category around its position */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer; /* Adds a pointer cursor to indicate interactivity */
            transition: transform 0.3s, box-shadow 0.3s; /* Adds smooth transitions for hover effects */
        }

        /* Optional: Add hover effects for better user experience */
        .category:hover {
            transform: translate(-50%, -50%) scale(1.05); /* Slightly enlarges the circle on hover */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); /* Enhances the shadow on hover */
        }

        .transport-container {
            position: absolute;
            width: 500px;
            height: 500px;
            background-color: #e0e0e0;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 2;
        }

        .transport-mode {
            position: absolute;
            width: 180px;
            height: 180px;
            padding: 10px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            background-color: rgba(245, 245, 245, 0);                        
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Added transition */
        }        

        .transport-mode img {
            width: 200px; /* Adjust the image size as needed */
            height: 200px;
            margin-bottom: 10px;
            transition: transform 0.3s ease; /* Optional: Smooth scaling of the image */
        }

        /* Hover Effect for Transport Modes */
        .transport-mode:hover {
            transform: scale(1.1); /* Increases size by 10% */            
        }

        .transport-mode:hover img {
            transform: scale(1.05); /* Optional: Slightly increase the image size for a layered effect */
        }

        /* Styles for the full-size image overlay */
        .full-image-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9); /* Semi-transparent dark background */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001; /* Higher than existing overlay z-index */
            cursor: pointer; /* Indicate that the overlay is clickable */
            padding: 0; /* Remove any default padding */
            margin: 0;  /* Remove any default margin */
            box-sizing: border-box; /* Ensure padding and border are included in the element's total width and height */
        }

        .full-image-overlay img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Adjust to 'cover' if you prefer cropping */
            box-shadow: none; /* Remove shadow for a cleaner look */
            border-radius: 0; /* Remove rounded corners */
        }

        #message {
            font-size: 40px; /* Increase font size */
            line-height: 1.5; /* Add line height for better readability */
            text-align: center; /* Center-align the text */
            font-weight: bold; /* Make the text bold for emphasis */
            color: #ffffff; /* Maintain the existing color */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* Add shadow to the text */
        }

        #categoriesCircle {
            font-size: 24px; /* Increase font size */
            text-align: center; /* Center-align the text */
            font-weight: bold; /* Make the text bold for emphasis */
            color: #333; /* Text color */            
        }

        #transportText {
            font-size: 24px; /* Increase font size */
            text-align: center; /* Center-align the text */
            font-weight: bold; /* Make the text bold for emphasis */
            color: #333; /* Text color */            
        }

        #actionButton {
            font-size: 20px; /* Set desired font size */
            font-weight: bold; /* Make the text bold for emphasis */
            padding: 12px 24px; /* Optional: Adjust padding for a better look */
            background-color: #fff; /* Optional: Background color */
            border: 1px solid #333; /* Optional: Border color */
            cursor: pointer; /* Pointer cursor on hover */
            border-radius: 5px; /* Optional: Rounded corners */
        }

        #overlayContent {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 1500px;
            text-align: left; /* Change from center to left */
            position: relative;
        }

        #overlayStory {
            text-align: left; /* Align text to the left */
        }

        #overlayStory h3 {
            text-align: left; /* Ensure headers are also aligned to the left */
        }
                
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="assets/logo.png" alt="Hitachi Logo">            
        </div>
        <h1>2050 Mobility Futures</h1>
    </header>
    <main>
        <div class="lines" id="lines">
            <div class="vertical-line"></div>
            <div class="horizontal-line"></div>
            <div class="label energy-efficient">Transformed</div>
            <div class="label energy-inefficient">Enhanced</div>
            <div class="label individual">Individual</div>
            <div class="label collective">Collective</div>
        </div>
        <div class="circle" id="circle">
            <p id="message">Do you want to explore how <br/>Mobility will be in the Future?</p>
            <button id="actionButton" onclick="handleButtonClick()">Let's Go</button>
        </div>
        
        <!-- Quadrant Circles with Green Percentage Circles -->
        <div class="quadrant-circle" id="circle1" style="top: 10px; left: 10%;">
            <div class="percentage-circle red-circle" id="percentage1"><span class="percentage-text"></span></div>
            <div class="percentage-circle green-circle" id="percentage1-green"><span class="percentage-text"></span></div>
            <div class="text-container">
                <strong>Scenario 1</strong><br>
                <span>The Age of Electric Personal Transport</span>
            </div>
        </div>
        <div class="quadrant-circle" id="circle2" style="top: 10px; right: 10%;">
            <div class="percentage-circle red-circle" id="percentage2"><span class="percentage-text"></span></div>
            <div class="percentage-circle green-circle" id="percentage2-green"><span class="percentage-text"></span></div>
            <div class="text-container">
                <strong>Scenario 2</strong><br>
                <span>Together Towards the Green Revolution</span>
            </div>
        </div>
        <div class="quadrant-circle" id="circle3" style="bottom: 0%; right: 10%;">
            <div class="percentage-circle red-circle" id="percentage3"><span class="percentage-text"></span></div>
            <div class="percentage-circle green-circle" id="percentage3-green"><span class="percentage-text"></span></div>
            <div class="text-container">                
                <strong>Scenario 3</strong><br>
                <span>Cautious Pace to Replace Societal Norms</span>
            </div>
        </div>
        <div class="quadrant-circle" id="circle4" style="bottom: 0%; left: 10%;">
            <div class="percentage-circle red-circle" id="percentage4"><span class="percentage-text"></span></div>
            <div class="percentage-circle green-circle" id="percentage4-green"><span class="percentage-text"></span></div>
            <div class="text-container">
                <strong>Scenario 4</strong><br>
                <span>The Adapting Path of Personal Transport</span>
            </div>
        </div>
        
        <div id="transportText" style="display: none; text-align: center; position: absolute; width: 100%; top: 50%; transform: translateY(-50%); z-index: 3;">
            Select the transport mode that interests you
        </div>
        
        <!-- Categories Circle -->
        <div class="categories-circle" id="categoriesCircle" style="display: none;"></div>    
        
    </main>
    <div id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 999; justify-content: center; align-items: center;">
        <div id="overlayContent" style="background-color: white; padding: 20px; border-radius: 8px; width: 80%; max-width: 1500px; text-align: center; position: relative;">
            <button onclick="closeOverlay()" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 20px; cursor: pointer;">&times;</button>
            <h2 id="overlayTitle"></h2>
            <img id="overlayImage" src="" alt="" style="width: 80%; height: auto; margin: 20px 0;">
            <div id="overlayStory">
                <h3>2030s</h3>
                <p id="story2030s"></p>
                <h3>2040s</h3>
                <p id="story2040s"></p>
                <h3>2050s</h3>
                <p id="story2050s"></p>
            </div>
        </div>
    </div>
    

    <!-- Include the scenarios.js file first -->
    <script src="scenarios.js"></script>
    <script>
        let currentState = 2; // 0: Initial state, 1: Show quadrants, 2: Show percentages       
    
        const categories = [
            "Energy Companies",
            "Public Transport",
            "Gov Agencies Or Public Authorities",
            "Transport Enthusiast",
            "Technology or Service Providers",
            "Infrastructure Manager",
            "Manufacturers"
        ];
    
        const transport_modes = [
            "Trains",
            "Metro",
            "Trams",
            "Buses",
            "EV Car",
            "Car Sharing and Rentals",
            "Taxi and Car Hailing",
            "Airplanes and Passenger Aviation",
            "eVTOLs",
            "E-Scooters",
            "Motorbikes and Scooters",
            "Bicycles"
        ];

        function handleLoadedScenarios(scenarios) {
            console.log('Scenarios:', scenarios);
            // Your logic to manipulate or display scenarios
        }
    
        function handleButtonClick() {
            if (currentState === 2) {      
                // Remove existing video if it exists
                const existingVideo = document.getElementById('backgroundVideo');
                if (existingVideo) {
                    existingVideo.remove();
                } 
                const circle = document.getElementById('circle');
                if (circle) {
                    circle.style.width = '500px';
                    circle.style.height = '500px';
                }                          
                showCategories();                
                currentState = 3;
                removeClearLocalStorageButton(); // Remove button when transitioning to state 3        
            }
        }

        function addClearLocalStorageButton() {
            // Check if the container for buttons already exists to avoid duplicating it
            let buttonContainer = document.getElementById('buttonContainer');
            if (!buttonContainer) {
                // Create a container for the buttons
                buttonContainer = document.createElement('div');
                buttonContainer.id = 'buttonContainer';
                buttonContainer.style.position = 'fixed';
                buttonContainer.style.bottom = '20px';
                buttonContainer.style.left = '50%';
                buttonContainer.style.transform = 'translateX(-50%)';
                buttonContainer.style.display = 'flex';
                buttonContainer.style.gap = '10px'; // Space between buttons
                buttonContainer.style.zIndex = '100'; // Ensure the container is on top

                // Append the container to the body
                document.body.appendChild(buttonContainer);
            }

            // Create the Reset button if it doesn't exist
            if (!document.getElementById('clearLocalStorageButton')) {
                const clearButton = document.createElement('button');
                clearButton.id = 'clearLocalStorageButton';
                clearButton.textContent = 'Reset';
                clearButton.style.padding = '10px 20px';
                clearButton.style.fontSize = '16px';
                clearButton.style.cursor = 'pointer';

                // Add click event to clear local storage with confirmation
                clearButton.onclick = function() {
                    if (confirm('Are you sure you want to reset all saved items? This action cannot be undone.')) {
                        localStorage.clear();
                        alert('All saved items have been cleared.');
                        // Refresh the page after saving
                        location.reload();
                    }
                };

                // Append the Reset button to the container
                buttonContainer.appendChild(clearButton);
            }

            // Create the Download button if it doesn't exist
            if (!document.getElementById('downloadLocalStorageButton')) {
                const downloadButton = document.createElement('button');
                downloadButton.id = 'downloadLocalStorageButton';
                downloadButton.textContent = 'Download';
                downloadButton.style.padding = '10px 20px';
                downloadButton.style.fontSize = '16px';
                downloadButton.style.cursor = 'pointer';

                // Add click event to download local storage data
                downloadButton.onclick = function() {
                    downloadLocalStorageData();
                };

                // Append the Download button to the container
                buttonContainer.appendChild(downloadButton);
            }
        }

        function removeClearLocalStorageButton() {
            const clearButton = document.getElementById('clearLocalStorageButton');
            if (clearButton) {
                clearButton.remove(); // Remove the button from the DOM
            }

            const downloadButton = document.getElementById('downloadLocalStorageButton');
            if (downloadButton) {
                downloadButton.remove(); // Remove the Download button from the DOM
            }
        }

        function downloadLocalStorageData() {
            const savedItems = JSON.parse(localStorage.getItem('savedItems')) || [];
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(savedItems, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "saved_data.json");
            document.body.appendChild(downloadAnchorNode); // Required for Firefox
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }
    
        function showCategories() {
            const categoriesCircle = document.getElementById('categoriesCircle');
            categoriesCircle.innerHTML = 'Which category would describe you best?'; // Clear existing content
    
            // Hide the axis lines and labels
            document.getElementById('lines').style.display = 'none';
    
            positionCategories(); // Call the function to position categories
    
            categoriesCircle.style.display = 'flex'; // Show the categories circle
            document.querySelectorAll('.quadrant-circle').forEach(circle => {
                circle.style.display = 'none'; // Hide all quadrant circles
            });
    
            // Now add click listeners to categories after they are positioned
            addCategoryClickListeners();
        }
    
        // Event listener to add click events to category circles
        function addCategoryClickListeners() {
            const categoryCircles = document.querySelectorAll('.category');
            categoryCircles.forEach(category => {
                category.addEventListener('click', handleCategoryClick);
            });
        }
    
        // Function to handle category circle clicks
        function handleCategoryClick(event) {
            const selectedCategory = event.target.textContent; // Get the selected category text
            showTransportModes(selectedCategory); // Show transport modes based on the selected category
        }

        function showOverlay(title, imageSrc, story2030s, story2040s, story2050s) {
            // Set the content for the overlay
            document.getElementById('overlayTitle').textContent = title;
            document.getElementById('overlayImage').src = imageSrc;
            document.getElementById('story2030s').textContent = story2030s;
            document.getElementById('story2040s').textContent = story2040s;
            document.getElementById('story2050s').textContent = story2050s;
            
            // Display the overlay
            document.getElementById('overlay').style.display = 'flex';
        }

        function closeOverlay() {
            document.getElementById('overlay').style.display = 'none';
        }

        // Add a click event listener to the overlay
        document.getElementById('overlay').addEventListener('click', function(event) {
            // Close the overlay only if the click is outside of the overlay content
            if (event.target === this) {
                closeOverlay();
            }
        });

        function handleTransportModeClick(selectedCategory, selectedTransportMode) {
            // Hide transport modes
            const transportContainer = document.querySelector('.transport-container');
            if (transportContainer) {
                transportContainer.style.display = 'none';
            }

            // Hide transport text
            const transportText = document.getElementById('transportText');
            transportText.style.display = 'none';

            // Ensure the central circle is displayed
            const centralCircle = document.getElementById('circle');
            centralCircle.style.display = 'flex';
            centralCircle.style.flexDirection = 'column';
            centralCircle.style.justifyContent = 'center';
            centralCircle.style.alignItems = 'center';
            centralCircle.style.position = 'relative';
            centralCircle.style.zIndex = '5';
            centralCircle.style.backgroundColor = '#ffffff';
            centralCircle.style.width = '600px';
            centralCircle.style.height = '600px';

            // Show the central axis lines
            document.getElementById('lines').style.display = 'block';

            // Clear any existing content inside the central circle
            centralCircle.innerHTML = ''; 

            // Create and add a label for the selected category
            const categoryLabel = document.createElement('div');
            categoryLabel.id = 'selectedCategoryLabel';
            categoryLabel.style.fontSize = '24px';
            categoryLabel.style.fontWeight = 'bold';
            categoryLabel.style.marginBottom = '0px';
            categoryLabel.style.zIndex = '6';
            categoryLabel.innerHTML = `${selectedCategory}<br/><br/>x`;
            centralCircle.appendChild(categoryLabel);

            // Create and add an image for the selected transport mode
            const transportImage = document.createElement('img');
            transportImage.id = 'selectedTransportImage';
            transportImage.src = `content/transport/${selectedTransportMode}.png`;
            transportImage.alt = selectedTransportMode;
            transportImage.style.width = '250px';
            transportImage.style.height = '250px';
            transportImage.style.marginBottom = '0px';
            transportImage.style.zIndex = '6';
            centralCircle.appendChild(transportImage);

            // Create and add a Save button
            const saveButton = document.createElement('button');
            saveButton.id = 'saveButton';
            saveButton.textContent = 'Vote';
            saveButton.style.marginTop = '10px';
            saveButton.style.padding = '5px 10px';
            saveButton.style.fontSize = '25px';
            saveButton.style.cursor = 'pointer';
            saveButton.style.zIndex = '6';
            saveButton.style.borderRadius = '5px'

            // Save button functionality                                
            saveButton.onclick = function() {
                const allContainers = document.querySelectorAll('.scenario-container');
                let preferableSelected = false;
                let probableSelected = false;
                let preferableQuadrant = '';
                let probableQuadrant = '';

                // Check if "preferable" and "probable" are selected
                allContainers.forEach((container, index) => {
                    const buttons = container.querySelectorAll('button');

                    buttons.forEach(button => {
                        if (button.textContent === 'Preferable' && button.style.backgroundColor === 'rgb(64, 203, 70)') { // Check for new green color
                            preferableSelected = true;
                            preferableQuadrant = index + 1; // Set the quadrant number based on index (1, 2, 3, 4)
                        }
                        if (button.textContent === 'Probable' && button.style.backgroundColor === 'rgb(31, 197, 250)') { // Check for new blue color
                            probableSelected = true;
                            probableQuadrant = index + 1; // Set the quadrant number based on index (1, 2, 3, 4)
                        }
                    });
                });

                if (!preferableSelected || !probableSelected) {
                    alert("Please select both a 'preferable' and 'probable' story.");
                } else {
                    // Save the selected data to local storage
                    const savedItems = JSON.parse(localStorage.getItem('savedItems')) || [];
                    const newItem = {
                        category: selectedCategory,
                        transportMode: selectedTransportMode,
                        preferableQuadrant: preferableQuadrant,
                        probableQuadrant: probableQuadrant
                    };

                    savedItems.push(newItem);
                    localStorage.setItem('savedItems', JSON.stringify(savedItems));
                    
                    // Display thank you message
                    alert("Thank you, your vote has been registered!");

                    // Refresh the page after saving
                    location.reload();
                }
            };
            centralCircle.appendChild(saveButton);

            // Create a unique key combining selectedCategory and selectedTransportMode
            const key = `${selectedCategory}|${selectedTransportMode}`;
            console.log(key)
            // Retrieve the scenario based on the selected category and transport mode
            const selected_scenarios = scenarios[key];
            console.log(selected_scenarios);

            const scenario1 = selected_scenarios["x_from_y_to"];
            const scenario1_image = `content/images/${selectedCategory}_${selectedTransportMode}_x_from_y_to.png`;
            const scenario1_title = scenario1["title"]
            const scenario1_2030s = scenario1["2030s"]
            const scenario1_2040s = scenario1["2040s"]
            const scenario1_2050s = scenario1["2050s"]
            const scenario2 = selected_scenarios["x_to_y_to"];
            const scenario2_image = `content/images/${selectedCategory}_${selectedTransportMode}_x_to_y_to.png`;
            const scenario2_title = scenario1["title"]
            const scenario2_2030s = scenario1["2030s"]
            const scenario2_2040s = scenario1["2040s"]
            const scenario2_2050s = scenario1["2050s"]
            const scenario3 = selected_scenarios["x_to_y_from"];
            const scenario3_image = `content/images/${selectedCategory}_${selectedTransportMode}_x_to_y_from.png`;
            const scenario3_title = scenario1["title"]
            const scenario3_2030s = scenario1["2030s"]
            const scenario3_2040s = scenario1["2040s"]
            const scenario3_2050s = scenario1["2050s"]
            const scenario4 = selected_scenarios["x_from_y_from"];
            const scenario4_image = `content/images/${selectedCategory}_${selectedTransportMode}_x_from_y_from.png`;
            const scenario4_title = scenario1["title"]
            const scenario4_2030s = scenario1["2030s"]
            const scenario4_2040s = scenario1["2040s"]
            const scenario_2050s = scenario1["2050s"]
            console.log(scenario1);
            console.log(scenario2);
            console.log(scenario3);
            console.log(scenario4);

            // Add scenario elements to each quadrant
            addScenarioToQuadrant(scenario1, scenario1_image, 'top', 'left');
            addScenarioToQuadrant(scenario2, scenario2_image, 'top', 'right');
            addScenarioToQuadrant(scenario3, scenario3_image, 'bottom', 'right');
            addScenarioToQuadrant(scenario4, scenario4_image, 'bottom', 'left');

        }

        function addScenarioToQuadrant(scenario, scenario_image, verticalAlign, horizontalAlign) {
            // Create a container for each scenario
            const scenarioContainer = document.createElement('div');
            scenarioContainer.className = 'scenario-container';
            scenarioContainer.style.position = 'absolute';
            scenarioContainer.style[verticalAlign] = '10%'; // Adjust the distance from the edge
            scenarioContainer.style[horizontalAlign] = '10%'; // Adjust the distance from the edge
            scenarioContainer.style.zIndex = '6'; // Ensure it is on top
            scenarioContainer.style.display = 'flex';
            scenarioContainer.style.flexDirection = 'column';
            scenarioContainer.style.alignItems = 'center';
            scenarioContainer.style.justifyContent = 'center';

            // Add scenario title
            const scenarioTitle = document.createElement('div');
            scenarioTitle.textContent = scenario.title;
            scenarioTitle.style.fontSize = '20px';
            scenarioTitle.style.fontWeight = 'bold';
            scenarioTitle.style.textAlign = 'center';
            scenarioTitle.style.marginBottom = '10px';

            // Add scenario image
            const scenarioImage = document.createElement('img');
            scenarioImage.src = scenario_image; // Update with the correct path
            scenarioImage.alt = scenario.title;
            scenarioImage.style.width = '500px';
            scenarioImage.style.height = '285px';
            scenarioImage.style.marginBottom = '10px';

            // Determine the position and order of elements based on the quadrant
            if (verticalAlign === 'top') {
                // If the scenario is in the top row, add the title first
                scenarioContainer.appendChild(scenarioTitle);
                scenarioContainer.appendChild(scenarioImage);
            } else {
                // If the scenario is in the bottom row, add the image first
                scenarioContainer.appendChild(scenarioImage);
                scenarioContainer.appendChild(scenarioTitle);
            }

            // Create a container for the buttons to align them horizontally
            const buttonContainer = document.createElement('div');
            buttonContainer.style.display = 'flex';
            buttonContainer.style.justifyContent = 'center';
            buttonContainer.style.gap = '10px'; // Space between the buttons
            buttonContainer.style.marginBottom = '10px'; // Margin below buttons

            // Add "Preferable" button with local SVG icon
            const preferableButton = document.createElement('button');
            preferableButton.innerHTML = `<img src="assets/preferable.svg" alt="Preferable Icon" style="width: 25px; height: 25px;">Preferable`;
            preferableButton.style.padding = '15px 30px';
            preferableButton.style.fontSize = '18px';
            preferableButton.style.width = '150px';
            preferableButton.style.cursor = 'pointer';
            preferableButton.style.backgroundColor = '#f5f5f5';
            preferableButton.style.border = 'none';
            preferableButton.style.boxShadow = 'none';
            preferableButton.style.margin = '0px';
            preferableButton.style.borderRadius = '20px'; 
            preferableButton.onclick = function(event) {
                event.stopPropagation(); // Prevent click event from bubbling up
                toggleSelection(preferableButton, 'preferable', scenarioContainer);
            };
            buttonContainer.appendChild(preferableButton);

            // Add "Probable" button with local SVG icon
            const probableButton = document.createElement('button');
            probableButton.innerHTML = `<img src="assets/probable.svg" alt="Probable Icon" style="width: 25px; height: 25px;">Probable`;
            probableButton.style.padding = '15px 30px';
            probableButton.style.fontSize = '18px';
            probableButton.style.width = '150px';
            probableButton.style.cursor = 'pointer';
            probableButton.style.backgroundColor = '#f5f5f5';
            probableButton.style.border = 'none';
            probableButton.style.boxShadow = 'none';
            probableButton.style.margin = '0px';
            probableButton.style.borderRadius = '20px'; 
            probableButton.onclick = function(event) {
                event.stopPropagation(); // Prevent click event from bubbling up
                toggleSelection(probableButton, 'probable', scenarioContainer);
            };
            buttonContainer.appendChild(probableButton);

            // Append the button container to the scenario container
            scenarioContainer.appendChild(buttonContainer);

            // Add click event to show the overlay
            scenarioContainer.addEventListener('click', function() {
                showOverlay(scenario.title, scenario_image, scenario["2030s"], scenario["2040s"], scenario["2050s"]);
            });

            // Append the scenario container to the main container
            document.querySelector('main').appendChild(scenarioContainer);
        }

        // Function to handle toggle behavior for the buttons        
        function toggleSelection(button, type, scenarioContainer) {
            const allContainers = document.querySelectorAll('.scenario-container');

            // Unselect all buttons of the same type in all containers
            allContainers.forEach(container => {
                const buttons = container.querySelectorAll('button');

                buttons.forEach(btn => {
                    if (btn.textContent === type.charAt(0).toUpperCase() + type.slice(1) && btn !== button) {
                        btn.style.backgroundColor = '#f5f5f5'; // Reset background color for all buttons of the same type
                    }
                });
            });

            // Toggle the selected state of the button
            if (button.style.backgroundColor === '#40CB46' && type === 'preferable' || button.style.backgroundColor === '#1FC5FA' && type === 'probable') {
                button.style.backgroundColor = ''; // Unselect if already selected
            } else {
                button.style.backgroundColor = type === 'preferable' ? '#40CB46' : '#1FC5FA'; // Select and mark it with appropriate color
            }
        }
            
        function showTransportModes(category) {
            // Hide all unnecessary elements
            const categoriesCircle = document.getElementById('categoriesCircle');
            categoriesCircle.innerHTML = ""; // Clear existing content

            // Show the transport mode selection text
            const transportText = document.getElementById('transportText');
            transportText.innerHTML = "Select the transport mode<br/>that interests you";            
            transportText.style.padding = "10px"; // Optional: Add padding
            transportText.style.width = "400px"; // Set width to 400px
            transportText.style.margin = "0 auto"; // Center the text box horizontally
            transportText.style.display = 'block'; // Ensure it is displayed
            transportText.style.top = '50%'; // Set top to 50%
            transportText.style.transform = 'translateY(-50%)'; // Center vertically
            transportText.style.zIndex = '3'; // Ensure it is on top

            // Remove previous transport container, if any
            const existingContainer = document.querySelector('.transport-container');
            if (existingContainer) existingContainer.remove();

            // Create a container for transport modes
            const transportContainer = document.createElement('div');
            transportContainer.className = 'transport-container';

            // Example images for transport modes (replace with actual paths)
            const transportImages = {
                "Trains": "content/transport/Trains.png",
                "Metro": "content/transport/Metro.png",
                "Trams": "content/transport/Trams.png",
                "Buses": "content/transport/Buses.png",
                "EV Car": "content/transport/EV Car.png",
                "Car Sharing and Rentals": "content/transport/Car Sharing and Rentals.png",
                "Taxi and Car Hailing": "content/transport/Taxi and Car Hailing.png",
                "Airplanes and Passenger Aviation": "content/transport/Airplanes and Passenger Aviation.png",
                "eVTOLs": "content/transport/eVTOLs.png",
                "E-Scooters": "content/transport/E-Scooters.png",
                "Motorbikes and Scooters": "content/transport/Motorbikes and Scooters.png",
                "Bicycles": "content/transport/Bicycles.png"
            };

            const centerX = 250; // X center of the transport container
            const centerY = 250; // Y center of the transport container
            const radius = 500;  // Distance from center to transport modes

            // Iterate over transport modes and create elements for each mode
            transport_modes.forEach((mode, index) => {
                const angle = (index / transport_modes.length) * (2 * Math.PI); // Calculate angle
                const x = centerX + radius * Math.cos(angle) - 90; // X position
                const y = centerY + radius * Math.sin(angle) - 90; // Y position

                const modeElement = document.createElement('div');
                modeElement.className = 'transport-mode';
                modeElement.style.left = `${x}px`;
                modeElement.style.top = `${y}px`;

                // Create and add an image element
                const imgElement = document.createElement('img');
                imgElement.src = transportImages[mode]; // Set the image source
                imgElement.alt = mode; // Set the alt text
                modeElement.appendChild(imgElement);


                // Add the mode text
                const modeText = document.createElement('span');
                modeText.textContent = mode;
                modeElement.appendChild(modeText);

                // Add click listener to the mode element
                modeElement.addEventListener('click', () => handleTransportModeClick(category, mode));

                transportContainer.appendChild(modeElement);
            });

            // Add the container to the main area
            document.querySelector('main').appendChild(transportContainer);
        }

        function hideTransportText() {
            document.getElementById('transportText').style.display = 'none';
        }
    
        function positionCategories() {
            // Check if the current state is not the showTransportModes state (state 3)
            if (currentState !== 3) {
                const centralCircle = document.getElementById('circle');
                const mainContainer = document.querySelector('main');
                const centerX = 350; // X center of the transport container
                const centerY = 350; // Y center of the transport container                

                const radius = 400; // Distance from center to categories, adjust as needed

                const categoriesCircle = document.getElementById('categoriesCircle');
                categoriesCircle.innerHTML = 'Which category would describe you best?'; // Clear existing content

                categories.forEach((category, index) => {
                    const angle = (index / categories.length) * (2 * Math.PI); // Calculate the angle for each category
                    const x = centerX + radius * Math.cos(angle) - 90; // X position relative to the center (adjust for width of element)
                    const y = centerY + radius * Math.sin(angle) - 90; // Y position relative to the center (adjust for height of element)

                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'category';
                    categoryDiv.style.left = `${x}px`;
                    categoryDiv.style.top = `${y}px`;                    

                    // Set the background image
                    categoryDiv.style.backgroundImage = `url('content/categories/${category}.png')`;
                    categoryDiv.style.backgroundSize = 'cover';
                    categoryDiv.style.backgroundPosition = 'center';
                    categoryDiv.style.backgroundRepeat = 'no-repeat';

                    // Optionally, remove the text or adjust its styling for better visibility
                    // If you want to keep the text, ensure it's readable over the image
                    categoryDiv.textContent = category;

                    categoriesCircle.appendChild(categoryDiv);
                });
            }
        }

        // Reposition categories on window resize
        window.addEventListener('resize', () => {
            positionCategories();
        });

        function loadSavedItems() {
            const savedItems = JSON.parse(localStorage.getItem('savedItems')) || [];
            console.log(savedItems); // Display saved items in the console or update your UI
        }
    
        // Function to initialize event listeners after page loads
        window.onload = function() {
            // Initialize by showing categories when needed                                    
            addCategoryClickListeners();
            handleLoadedScenarios(scenarios);
            loadSavedItems();            
            showPercentages();
            addClearLocalStorageButton()
        };
    
        function showLinesAndCircles() {
            document.getElementById('lines').style.display = 'block';
            document.getElementById('message').innerHTML = 'The Future is not decided yet.<br/> Where is European mobility heading?';
            document.querySelectorAll('.quadrant-circle').forEach(circle => {
                circle.style.display = 'flex'; // Show all quadrant circles
            });
    
            // Hide percentage circles in the second state
            document.querySelectorAll('.percentage-circle').forEach(circle => {
                circle.style.display = 'none'; // Ensure percentage circles are hidden
            });
        }
    
        function showPercentages() {
            // Ensure axis lines and labels are visible
            document.getElementById('lines').style.display = 'block';
            document.getElementById('message').innerHTML = 'The Future is not decided yet.<br/> Where is European mobility heading?';

            // Add the video dynamically to the center circle
            const circle = document.getElementById('circle');

            // Remove existing video if it exists
            const existingVideo = document.getElementById('backgroundVideo');
            if (existingVideo) {
                existingVideo.remove();
            }

            // Create the video element
            const videoElement = document.createElement('video');
            videoElement.id = 'backgroundVideo';
            videoElement.autoplay = true;
            videoElement.muted = true;
            videoElement.loop = true;
            videoElement.playsInline = true;

            // Set the video source
            const sourceElement = document.createElement('source');
            sourceElement.src = 'content/video.mp4'; // Replace with your video path
            sourceElement.type = 'video/mp4';
            videoElement.appendChild(sourceElement);

            // Insert the video as the background
            circle.insertBefore(videoElement, circle.firstChild);

            // Apply necessary CSS styles
            videoElement.style.position = 'absolute';
            videoElement.style.top = '50%';
            videoElement.style.left = '50%';
            videoElement.style.width = '100%';
            videoElement.style.height = 'auto';
            videoElement.style.minHeight = '100%';
            videoElement.style.objectFit = 'cover';
            videoElement.style.transform = 'translate(-50%, -50%)';
            videoElement.style.zIndex = '1';

            // Show quadrant circles
            document.querySelectorAll('.quadrant-circle').forEach(circle => {
                circle.style.display = 'flex'; // Ensure quadrant circles are visible
            });

            // Retrieve saved items from localStorage
            const savedItems = JSON.parse(localStorage.getItem('savedItems')) || [];
            const totalItems = savedItems.length;

            // Determine previous items (all except the last one if 2 or more exist)
            let previousItems = [];
            if (totalItems >= 2) {
                previousItems = savedItems.slice(0, -1);
            }

            // Calculate previous counts for probable and preferable
            let probableCountsPrev = {1: 0, 2: 0, 3: 0, 4: 0};
            let preferableCountsPrev = {1: 0, 2: 0, 3: 0, 4: 0};

            previousItems.forEach(item => {
                if (item.probableQuadrant) {
                    probableCountsPrev[item.probableQuadrant]++;
                }
                if (item.preferableQuadrant) {
                    preferableCountsPrev[item.preferableQuadrant]++;
                }
            });

            const totalPrevItems = previousItems.length;

            // Calculate previous percentages
            let probablePercentagesPrev = {
                1: totalPrevItems > 0 ? Math.round((probableCountsPrev[1] / totalPrevItems) * 100) : 0,
                2: totalPrevItems > 0 ? Math.round((probableCountsPrev[2] / totalPrevItems) * 100) : 0,
                3: totalPrevItems > 0 ? Math.round((probableCountsPrev[3] / totalPrevItems) * 100) : 0,
                4: totalPrevItems > 0 ? Math.round((probableCountsPrev[4] / totalPrevItems) * 100) : 0
            };

            let preferablePercentagesPrev = {
                1: totalPrevItems > 0 ? Math.round((preferableCountsPrev[1] / totalPrevItems) * 100) : 0,
                2: totalPrevItems > 0 ? Math.round((preferableCountsPrev[2] / totalPrevItems) * 100) : 0,
                3: totalPrevItems > 0 ? Math.round((preferableCountsPrev[3] / totalPrevItems) * 100) : 0,
                4: totalPrevItems > 0 ? Math.round((preferableCountsPrev[4] / totalPrevItems) * 100) : 0
            };

            // Calculate current counts for probable and preferable
            let probableCounts = {1: 0, 2: 0, 3: 0, 4: 0};
            let preferableCounts = {1: 0, 2: 0, 3: 0, 4: 0};

            savedItems.forEach(item => {
                if (item.probableQuadrant) {
                    probableCounts[item.probableQuadrant]++;
                }
                if (item.preferableQuadrant) {
                    preferableCounts[item.preferableQuadrant]++;
                }
            });

            const currentTotalItems = totalItems;

            // Calculate current percentages
            let probablePercentages = {
                1: currentTotalItems > 0 ? Math.round((probableCounts[1] / currentTotalItems) * 100) : 0,
                2: currentTotalItems > 0 ? Math.round((probableCounts[2] / currentTotalItems) * 100) : 0,
                3: currentTotalItems > 0 ? Math.round((probableCounts[3] / currentTotalItems) * 100) : 0,
                4: currentTotalItems > 0 ? Math.round((probableCounts[4] / currentTotalItems) * 100) : 0
            };

            let preferablePercentages = {
                1: currentTotalItems > 0 ? Math.round((preferableCounts[1] / currentTotalItems) * 100) : 0,
                2: currentTotalItems > 0 ? Math.round((preferableCounts[2] / currentTotalItems) * 100) : 0,
                3: currentTotalItems > 0 ? Math.round((preferableCounts[3] / currentTotalItems) * 100) : 0,
                4: currentTotalItems > 0 ? Math.round((preferableCounts[4] / currentTotalItems) * 100) : 0
            };

            // Set previous percentages first (no animation)
            for (let i = 1; i <= 4; i++) {
                // Probable circles (red)
                const probableCircle = document.getElementById(`percentage${i}`);
                const probableSizePrev = probablePercentagesPrev[i] * 5; // Scale the size
                probableCircle.style.width = `${probableSizePrev}px`;
                probableCircle.style.height = `${probableSizePrev}px`;
                probableCircle.style.left = `calc(50% - ${probableSizePrev / 2}px)`; // Center horizontally
                probableCircle.style.top = `calc(50% - ${probableSizePrev / 2}px)`;  // Center vertically
                probableCircle.style.display = 'flex'; // Make percentage circles visible                

                // Preferable circles (green)
                const preferableCircle = document.getElementById(`percentage${i}-green`);
                const preferableSizePrev = preferablePercentagesPrev[i] * 5; // Scale the size
                preferableCircle.style.width = `${preferableSizePrev}px`;
                preferableCircle.style.height = `${preferableSizePrev}px`;
                preferableCircle.style.left = `calc(50% - ${preferableSizePrev / 2}px)`; // Center horizontally
                preferableCircle.style.top = `calc(50% - ${preferableSizePrev / 2}px)`;  // Center vertically
                preferableCircle.style.display = 'flex'; // Make percentage circles visible
                
                // Create percentage text elements
                let percentageTextElement = document.createElement('div');
                percentageTextElement.style.position = 'absolute';
                percentageTextElement.style.fontSize = '14px';
                percentageTextElement.style.fontWeight = 'bold';
                percentageTextElement.style.textAlign = 'center';
                percentageTextElement.style.zIndex = '3';
                percentageTextElement.style.lineHeight = '1.5'; // Line height for spacing between lines

                // Set the position for percentage text
                if (i === 1 || i === 2) {
                    percentageTextElement.style.bottom = '-80px'; // Position below quadrants 1 and 2 with extra space
                } else {
                    percentageTextElement.style.top = '-80px'; // Position above quadrants 3 and 4 with extra space
                }

                // Set the text content with colored span elements
                percentageTextElement.innerHTML = `
                    <span style="color: #40CB46;">Preferable: ${preferablePercentages[i]}%</span><br>
                    <span style="color: #1FC5FA;">Probable: ${probablePercentages[i]}%</span>
                `;

                // Append the text element to the corresponding quadrant
                document.getElementById(`circle${i}`).appendChild(percentageTextElement);
            }

            // Force reflow to apply the previous styles
            void document.getElementById('circle').offsetWidth;

            // After a short delay, set to current percentages to trigger animation
            setTimeout(() => {
                for (let i = 1; i <= 4; i++) {
                    // Probable circles (red)
                    const probableCircle = document.getElementById(`percentage${i}`);
                    const probableSize = probablePercentages[i] * 5; // Scale the size
                    probableCircle.style.width = `${probableSize}px`;
                    probableCircle.style.height = `${probableSize}px`;
                    probableCircle.style.left = `calc(50% - ${probableSize / 2}px)`; // Center horizontally
                    probableCircle.style.top = `calc(50% - ${probableSize / 2}px)`;  // Center vertically                    

                    // Preferable circles (green)
                    const preferableCircle = document.getElementById(`percentage${i}-green`);
                    const preferableSize = preferablePercentages[i] * 5; // Scale the size
                    preferableCircle.style.width = `${preferableSize}px`;
                    preferableCircle.style.height = `${preferableSize}px`;
                    preferableCircle.style.left = `calc(50% - ${preferableSize / 2}px)`; // Center horizontally
                    preferableCircle.style.top = `calc(50% - ${preferableSize / 2}px)`;  // Center vertically
                    
                }
            }, 100); // 100ms delay to allow previous styles to apply
        }
        
        // Function to create and display the full-size image overlay
        function showFullImageOverlay(imageSrc, imageAlt) {
            // Create the overlay div
            const fullImageOverlay = document.createElement('div');
            fullImageOverlay.className = 'full-image-overlay';

            // Create the image element
            const img = document.createElement('img');
            img.src = imageSrc;
            img.alt = imageAlt;

            // Append the image to the overlay
            fullImageOverlay.appendChild(img);

            // Append the overlay to the body
            document.body.appendChild(fullImageOverlay);

            // Add click event to the overlay to remove it when clicked
            fullImageOverlay.addEventListener('click', () => {
                fullImageOverlay.remove();
            });
        }

        // Function to initialize the click event on the overlay image
        function initializeOverlayImageClick() {
            const overlayImage = document.getElementById('overlayImage');
            if (overlayImage) {
                overlayImage.style.cursor = 'pointer'; // Indicate that the image is clickable
                overlayImage.addEventListener('click', (event) => {
                    event.stopPropagation(); // Prevent the click from bubbling up to the overlay
                    showFullImageOverlay(overlayImage.src, overlayImage.alt);
                });
            }
        }

        // Modify the showOverlay function to initialize the image click after showing the overlay
        function showOverlay(title, imageSrc, story2030s, story2040s, story2050s) {
            // Set the content for the overlay
            document.getElementById('overlayTitle').textContent = title;
            document.getElementById('overlayImage').src = imageSrc;
            document.getElementById('story2030s').textContent = story2030s;
            document.getElementById('story2040s').textContent = story2040s;
            document.getElementById('story2050s').textContent = story2050s;
            
            // Display the overlay
            document.getElementById('overlay').style.display = 'flex';

            // Initialize the click event on the overlay image
            initializeOverlayImageClick();
        }
    </script>
</body>
</html>